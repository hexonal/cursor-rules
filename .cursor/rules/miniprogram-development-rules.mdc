---
description: 
globs: 
alwaysApply: false
---
# å¾®ä¿¡å°ç¨‹åºå¼€å‘è§„åˆ™

---
## ğŸ“‹ è§„åˆ™å…ƒæ•°æ®
- **è§„åˆ™ç±»å‹**: å¹³å°åŸºç¡€è§„åˆ™ (Platform Foundation Rules)
- **ä½œç”¨åŸŸ**: å¾®ä¿¡å°ç¨‹åºå¹³å°å¼€å‘
- **è‡ªåŠ¨é™„åŠ æ¡ä»¶**: `*.js`, `*.json`, `*.wxml`, `*.wxss` æ–‡ä»¶
- **ä¼˜å…ˆçº§**: åŸºç¡€å¹³å°è§„åˆ™ (Priority: 100)
- **è¢«å¼•ç”¨äº**: å…¶ä»–é¡¹ç›®ç‰¹å®šè§„åˆ™
- **å†²çªè§£å†³**: ä¸šåŠ¡ç‰¹å®šè§„åˆ™ > å¹³å°åŸºç¡€è§„åˆ™

## ğŸ“š è§„åˆ™å¼•ç”¨ç³»ç»Ÿ
```markdown
è¯­æ³•: [è§„åˆ™æ–‡ä»¶](mdc:.cursor/rules/è§„åˆ™æ–‡ä»¶.mdc)
ç¤ºä¾‹: [ç¼–ç è§„èŒƒ](mdc:.cursor/rules/coding-standards.mdc)
å†²çªè§£å†³: å½“å‰è§„åˆ™ä¼˜å…ˆçº§ < å¼•ç”¨è§„åˆ™ä¼˜å…ˆçº§æ—¶ï¼Œå¼•ç”¨è§„åˆ™ç”Ÿæ•ˆ
```
---

## ğŸ—ï¸ å°ç¨‹åºæ¶æ„è®¾è®¡

> ğŸ”— **ç¼–ç è§„èŒƒ**: [ç¼–ç è§„èŒƒè¯¦ç»†æŒ‡å—](mdc:.cursor/rules/coding-standards.mdc)  
> ğŸ“ **åŒ…å«**: å‘½åçº¦å®šã€ä»£ç ç»“æ„ã€æ³¨é‡Šè§„èŒƒã€é”™è¯¯å¤„ç†

### ç»„ä»¶åŒ–è®¾è®¡åŸåˆ™
```javascript
// ç»„ä»¶æ ‡å‡†ç»“æ„
Component({
  options: {
    // ç»„ä»¶é…ç½®
    multipleSlots: true,
    addGlobalClass: true,
  },
  
  properties: {
    // å¯¹å¤–å±æ€§ï¼Œä½¿ç”¨observerç›‘å¬å˜åŒ–
    data: {
      type: Object,
      value: {},
      observer(newVal, oldVal) {
        this.processDataChange(newVal, oldVal);
      },
    },
  },
  
  data: {
    // å†…éƒ¨çŠ¶æ€
    internalState: '',
  },
  
  lifetimes: {
    attached() {
      // ç»„ä»¶åˆå§‹åŒ–
      this.initComponent();
    },
    
    detached() {
      // èµ„æºæ¸…ç†ï¼Œé˜²æ­¢å†…å­˜æ³„æ¼
      this.cleanup();
    },
  },
  
  methods: {
    // å…¬å…±æ–¹æ³•ç”¨$å‰ç¼€
    $publicMethod() {},
    
    // äº‹ä»¶å¤„ç†ç”¨handleå‰ç¼€
    handleUserAction() {},
    
    // å†…éƒ¨æ–¹æ³•ç”¨å¸¸è§„å‘½å
    processData() {},
  },
});
```

### é¡µé¢ç”Ÿå‘½å‘¨æœŸç®¡ç†
```javascript
Page({
  data: {
    // é¡µé¢æ•°æ®
  },
  
  onLoad(options) {
    // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
    this.initPage(options);
  },
  
  onShow() {
    // é¡µé¢æ˜¾ç¤ºæ—¶çš„å¤„ç†
    this.refreshData();
  },
  
  onHide() {
    // é¡µé¢éšè—æ—¶æš‚åœæ“ä½œ
    this.pauseOperations();
  },
  
  onUnload() {
    // é¡µé¢å¸è½½æ—¶æ¸…ç†èµ„æº
    this.cleanup();
  },
});
```

## âš¡ æ€§èƒ½ä¼˜åŒ–è§„åˆ™ {#æ€§èƒ½ä¼˜åŒ–è§„åˆ™}

> ğŸ“ **æ‰©å±•è¯´æ˜**: é€‚ç”¨äºæ‰€æœ‰éœ€è¦æ‰¹é‡æ•°æ®æ›´æ–°çš„åœºæ™¯

### setDataä¼˜åŒ– {#setDataä¼˜åŒ–}
```javascript
// âœ… æ­£ç¡®çš„setDataä½¿ç”¨
methods: {
  // æ‰¹é‡æ›´æ–°æ•°æ®
  batchUpdate() {
    this.setData({
      'list[0].name': 'new name',
      'list[0].status': 'active',
      updateTime: Date.now(),
    });
  },
  
  // ä½¿ç”¨å›è°ƒç¡®ä¿æ›´æ–°å®Œæˆ
  updateWithCallback() {
    this.setData({
      loading: false,
    }, () => {
      // æ•°æ®æ›´æ–°å®Œæˆåçš„æ“ä½œ
      this.afterUpdate();
    });
  },
  
  // é¿å…é¢‘ç¹æ›´æ–°ï¼Œä½¿ç”¨é˜²æŠ–
  onInputChange: throttle(function(e) {
    this.setData({
      inputValue: e.detail.value,
    });
  }, 300),
}

// âŒ é¿å…çš„åšæ³•
methods: {
  badUpdate() {
    // é¿å…é¢‘ç¹è°ƒç”¨setData
    this.setData({ loading: true });
    this.setData({ data: newData });
    this.setData({ loading: false });
  },
}
```

### é•¿åˆ—è¡¨ä¼˜åŒ– {#é•¿åˆ—è¡¨ä¼˜åŒ–}

> ğŸ“ **æ‰©å±•è¯´æ˜**: é€‚ç”¨äºæ‰€æœ‰é•¿åˆ—è¡¨å±•ç¤ºåœºæ™¯ï¼Œå¦‚å•†å“åˆ—è¡¨ã€å†…å®¹åˆ—è¡¨ç­‰

```javascript
// è™šæ‹Ÿåˆ—è¡¨å®ç°
Component({
  data: {
    visibleStart: 0,
    visibleEnd: 20,
    itemHeight: 100,
    renderList: [],
  },
  
  methods: {
    onScroll(e) {
      const scrollTop = e.detail.scrollTop;
      const containerHeight = this.data.containerHeight;
      
      const visibleStart = Math.floor(scrollTop / this.data.itemHeight);
      const visibleEnd = visibleStart + Math.ceil(containerHeight / this.data.itemHeight) + 1;
      
      this.setData({
        visibleStart,
        visibleEnd,
        renderList: this.data.fullList.slice(visibleStart, visibleEnd),
      });
    },
  },
});
```

## ğŸ“± å°ç¨‹åºç‰¹æœ‰é™åˆ¶å¤„ç†

### åŒ…ä½“ç§¯ç®¡ç†
```javascript
// åˆ†åŒ…é…ç½®ç¤ºä¾‹
// app.json
{
  "pages": [
    "pages/index/index"
  ],
  "subPackages": [
    {
      "root": "packages/feature-a",
      "pages": [
        "pages/detail/detail"
      ]
    }
  ],
  "preloadRule": {
    "pages/index/index": {
      "network": "all",
      "packages": ["feature-a"]
    }
  }
}

// åŠ¨æ€å¯¼å…¥
methods: {
  async loadFeature() {
    try {
      const module = await import('../../packages/feature-a/utils');
      return module.default;
    } catch (error) {
      console.error('Load feature failed:', error);
    }
  },
}
```

### å†…å­˜ç®¡ç† {#å†…å­˜ç®¡ç†}

> ğŸ“ **æ‰©å±•è¯´æ˜**: é€‚ç”¨äºæ‰€æœ‰éœ€è¦ç¼“å­˜ç®¡ç†çš„åœºæ™¯ï¼Œå¦‚æ•°æ®ç¼“å­˜ã€å›¾ç‰‡ç¼“å­˜ç­‰

```javascript
// å†…å­˜ä½¿ç”¨ç›‘æ§
const MemoryManager = {
  maxDataSize: 50 * 1024 * 1024, // 50MB
  
  checkMemoryUsage() {
    // ä¼°ç®—æ•°æ®å¤§å°
    const dataSize = JSON.stringify(getCurrentPageData()).length;
    
    if (dataSize > this.maxDataSize) {
      this.triggerDataCleanup();
    }
  },
  
  triggerDataCleanup() {
    // æ¸…ç†éå¿…è¦æ•°æ®
    wx.getCurrentPages().forEach(page => {
      if (page.cleanup && typeof page.cleanup === 'function') {
        page.cleanup();
      }
    });
  },
};
```

## ğŸ”’ æƒé™ç®¡ç†

### ç»Ÿä¸€æƒé™å¤„ç†
```javascript
const PermissionManager = {
  async requestPermission(scope, options = {}) {
    try {
      // æ£€æŸ¥å½“å‰æƒé™çŠ¶æ€
      const setting = await this.getSetting();
      const hasPermission = setting.authSetting[scope];
      
      if (hasPermission === true) {
        return true;
      }
      
      if (hasPermission === false) {
        // å·²æ‹’ç»ï¼Œå¼•å¯¼åˆ°è®¾ç½®é¡µ
        return this.openSetting(options);
      }
      
      // é¦–æ¬¡ç”³è¯·
      return this.authorize(scope);
      
    } catch (error) {
      console.error('Permission request failed:', error);
      return false;
    }
  },
  
  getSetting() {
    return new Promise((resolve, reject) => {
      wx.getSetting({
        success: resolve,
        fail: reject,
      });
    });
  },
  
  authorize(scope) {
    return new Promise((resolve) => {
      wx.authorize({
        scope,
        success: () => resolve(true),
        fail: () => resolve(false),
      });
    });
  },
  
  openSetting(options) {
    return new Promise((resolve) => {
      wx.showModal({
        title: options.title || 'æƒé™ç”³è¯·',
        content: options.content || 'éœ€è¦ç›¸å…³æƒé™æ‰èƒ½ä½¿ç”¨è¯¥åŠŸèƒ½',
        success: (res) => {
          if (res.confirm) {
            wx.openSetting({
              success: () => resolve(true),
              fail: () => resolve(false),
            });
          } else {
            resolve(false);
          }
        },
      });
    });
  },
};
```

## ğŸŒ ç½‘ç»œè¯·æ±‚ç®¡ç†

### è¯·æ±‚å°è£…
```javascript
const RequestManager = {
  baseURL: '',
  timeout: 10000,
  maxRetry: 3,
  
  async request(options) {
    const requestOptions = {
      url: this.baseURL + options.url,
      method: options.method || 'GET',
      data: options.data,
      header: {
        'content-type': 'application/json',
        ...options.header,
      },
      timeout: options.timeout || this.timeout,
    };
    
    return this.executeWithRetry(requestOptions, options.retry || this.maxRetry);
  },
  
  async executeWithRetry(options, retryCount) {
    try {
      return await this.executeRequest(options);
    } catch (error) {
      if (retryCount > 0 && this.shouldRetry(error)) {
        await this.delay(1000);
        return this.executeWithRetry(options, retryCount - 1);
      }
      throw error;
    }
  },
  
  executeRequest(options) {
    return new Promise((resolve, reject) => {
      wx.request({
        ...options,
        success: (res) => {
          if (res.statusCode >= 200 && res.statusCode < 300) {
            resolve(res.data);
          } else {
            reject(new Error(`HTTP ${res.statusCode}`));
          }
        },
        fail: reject,
      });
    });
  },
  
  shouldRetry(error) {
    // ç½‘ç»œé”™è¯¯æˆ–è¶…æ—¶æ‰é‡è¯•
    return error.errMsg && (
      error.errMsg.includes('timeout') ||
      error.errMsg.includes('fail')
    );
  },
  
  delay(ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
  },
};
```

## ğŸ› ï¸ å·¥å…·å‡½æ•°è§„èŒƒ

### é€šç”¨å·¥å…·
```javascript
// é˜²æŠ–å‡½æ•°
function debounce(func, wait) {
  let timeout;
  return function executedFunction(...args) {
    const later = () => {
      clearTimeout(timeout);
      func.apply(this, args);
    };
    clearTimeout(timeout);
    timeout = setTimeout(later, wait);
  };
}

// èŠ‚æµå‡½æ•°
function throttle(func, limit) {
  let inThrottle;
  return function executedFunction(...args) {
    if (!inThrottle) {
      func.apply(this, args);
      inThrottle = true;
      setTimeout(() => inThrottle = false, limit);
    }
  };
}

// æ·±æ‹·è´
function deepClone(obj) {
  if (obj === null || typeof obj !== 'object') return obj;
  if (obj instanceof Date) return new Date(obj.getTime());
  if (obj instanceof Array) return obj.map(item => deepClone(item));
  if (typeof obj === 'object') {
    const clonedObj = {};
    for (const key in obj) {
      if (obj.hasOwnProperty(key)) {
        clonedObj[key] = deepClone(obj[key]);
      }
    }
    return clonedObj;
  }
}
```

## ğŸ“‹ ä»£ç è§„èŒƒ

### å‘½åçº¦å®š
- **é¡µé¢/ç»„ä»¶**: PascalCase (UserProfile)
- **æ–¹æ³•/å˜é‡**: camelCase (getUserInfo)
- **å¸¸é‡**: UPPER_SNAKE_CASE (MAX_RETRY_COUNT)
- **æ–‡ä»¶å**: kebab-case (user-profile.js)

### é”™è¯¯å¤„ç†
```javascript
// ç»Ÿä¸€é”™è¯¯å¤„ç†
const ErrorHandler = {
  handle(error, context) {
    console.error(`Error in ${context}:`, error);
    
    // æ ¹æ®é”™è¯¯ç±»å‹æ˜¾ç¤ºä¸åŒæç¤º
    const message = this.getErrorMessage(error);
    wx.showToast({
      title: message,
      icon: 'none',
    });
  },
  
  getErrorMessage(error) {
    const errorMap = {
      'network': 'ç½‘ç»œè¿æ¥å¤±è´¥',
      'timeout': 'è¯·æ±‚è¶…æ—¶',
      'permission': 'æƒé™ä¸è¶³',
    };
    
    return errorMap[error.type] || 'æ“ä½œå¤±è´¥ï¼Œè¯·é‡è¯•';
  },
};
```
