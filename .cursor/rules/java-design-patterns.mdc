---
description: 
globs: 
alwaysApply: true
---
# Javaé¡¹ç›®è®¾è®¡æ¨¡å¼ç²¾ç»†åŒ–åº”ç”¨è§„èŒƒ

æœ¬è§„èŒƒæä¾›ç²¾ç»†åŒ–ã€æ˜ç¡®çš„è®¾è®¡æ¨¡å¼åº”ç”¨æŒ‡å¯¼ï¼Œé€šè¿‡Cursorä»£ç åº“ç´¢å¼•æŠ€æœ¯ï¼ŒåŸºäºé¡¹ç›®ç°æœ‰æ¨¡å¼æä¾›å…·ä½“çš„å®ç°è§„èŒƒå’Œçº¦æŸè§„åˆ™ã€‚

## ä¸€ã€è®¾è®¡æ¨¡å¼åº”ç”¨åŸåˆ™ä¸çº¦æŸ

### ã€å¼ºåˆ¶ã€‘è®¾è®¡æ¨¡å¼å¼•å…¥æ¡ä»¶
1. **å¿…é¡»æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ä¹‹ä¸€æ‰å¯å¼•å…¥è®¾è®¡æ¨¡å¼**ï¼š
   ```
   æç¤ºè¯ï¼š@codebase åˆ†æè¿™æ®µä»£ç æ˜¯å¦æ»¡è¶³è®¾è®¡æ¨¡å¼å¼•å…¥æ¡ä»¶ï¼š
   1. å­˜åœ¨3ä¸ªä»¥ä¸Šç›¸ä¼¼çš„å®ç°ç±»æˆ–æ–¹æ³•
   2. ä¸šåŠ¡é€»è¾‘å­˜åœ¨æ˜ç¡®çš„å˜åŒ–ç‚¹å’Œæ‰©å±•éœ€æ±‚
   3. ç°æœ‰if-elseåˆ†æ”¯è¶…è¿‡5ä¸ªä¸”é€»è¾‘å¤æ‚
   4. å¯¹è±¡åˆ›å»ºè¿‡ç¨‹å¤æ‚ä¸”éœ€è¦å¤šæ­¥éª¤éªŒè¯
   5. éœ€è¦è§£è€¦å…·ä½“å®ç°ä¸æ¥å£è°ƒç”¨
   ```

2. **ç¦æ­¢è¿‡åº¦è®¾è®¡**ï¼š
   - ç¦æ­¢ä¸ºäº†ä½¿ç”¨è®¾è®¡æ¨¡å¼è€Œè®¾è®¡æ¨¡å¼
   - ç¦æ­¢åœ¨ç®€å•åœºæ™¯ä¸­å¼•å…¥å¤æ‚æ¨¡å¼
   - ç¦æ­¢åŒæ—¶ä½¿ç”¨å¤šä¸ªè®¾è®¡æ¨¡å¼å¯¼è‡´è¿‡åº¦æŠ½è±¡

### ã€å¼ºåˆ¶ã€‘è®¾è®¡æ¨¡å¼å‘½åè§„èŒƒ
1. **å·¥å‚ç±»å‘½å**ï¼š`ä¸šåŠ¡åç§° + Factory`
   - æ­£ç¡®ï¼š`OrderFactory`ã€`UserFactory`ã€`PaymentFactory`
   - é”™è¯¯ï¼š`CreateOrder`ã€`OrderCreator`ã€`OrderBuilder`ï¼ˆBuilderæ˜¯å¦ä¸€ç§æ¨¡å¼ï¼‰

2. **ç­–ç•¥ç±»å‘½å**ï¼š`å…·ä½“ç­–ç•¥æè¿° + Strategy`
   - æ­£ç¡®ï¼š`FixedAmountDiscountStrategy`ã€`PercentageDiscountStrategy`
   - é”™è¯¯ï¼š`DiscountHandler`ã€`DiscountProcessor`ã€`DiscountService`

3. **é€‚é…å™¨ç±»å‘½å**ï¼š`å¤–éƒ¨ç³»ç»Ÿåç§° + Adapter`
   - æ­£ç¡®ï¼š`AlipayPaymentAdapter`ã€`WechatPaymentAdapter`
   - é”™è¯¯ï¼š`PaymentIntegration`ã€`PaymentGateway`

## äºŒã€å·¥å‚æ¨¡å¼ç²¾ç»†åŒ–è§„èŒƒ

### ã€å¼ºåˆ¶ã€‘å·¥å‚æ¨¡å¼é€‚ç”¨åœºæ™¯è¯†åˆ«
```
æç¤ºè¯ï¼š@codebase æ£€æŸ¥ä»¥ä¸‹åœºæ™¯æ˜¯å¦é€‚åˆä½¿ç”¨å·¥å‚æ¨¡å¼ï¼š
1. å¯¹è±¡åˆ›å»ºéœ€è¦5ä¸ªä»¥ä¸Šå‚æ•°
2. åˆ›å»ºè¿‡ç¨‹éœ€è¦è°ƒç”¨3ä¸ªä»¥ä¸Šå¤–éƒ¨æœåŠ¡
3. åˆ›å»ºé€»è¾‘åŒ…å«å¤æ‚çš„ä¸šåŠ¡è§„åˆ™æ ¡éªŒ
4. åŒä¸€ç±»å‹å¯¹è±¡æœ‰3ç§ä»¥ä¸Šåˆ›å»ºæ–¹å¼

å¦‚æœæ»¡è¶³2ä¸ªä»¥ä¸Šæ¡ä»¶ï¼Œæ¨èä½¿ç”¨å·¥å‚æ¨¡å¼
```

### ã€å¼ºåˆ¶ã€‘å·¥å‚æ¨¡å¼å®ç°è§„èŒƒ
1. **å·¥å‚ç±»ç»“æ„è§„èŒƒ**ï¼š
   ```java
   // åŸºäºé¡¹ç›®ç°æœ‰å·¥å‚æ¨¡å¼åˆ†æ
   // æç¤ºè¯ï¼š@codebase åˆ†æç°æœ‰Factoryç±»ï¼Œç¡®ä¿æ–°å·¥å‚éµå¾ªç›¸åŒç»“æ„
   
   @Component  // å¿…é¡»ä½¿ç”¨Springç®¡ç†
   @RequiredArgsConstructor  // å¿…é¡»ä½¿ç”¨æ„é€ å™¨æ³¨å…¥
   public class OrderFactory {
       
       // ã€å¼ºåˆ¶ã€‘ä¾èµ–æ³¨å…¥ - å¿…é¡»ä¸ºfinal
       private final ProductRepository productRepository;
       private final PricingService pricingService;
       
       // ã€å¼ºåˆ¶ã€‘ä¸»è¦åˆ›å»ºæ–¹æ³•å‘½åè§„èŒƒï¼šcreate + å¯¹è±¡å
       public Order createOrder(CreateOrderCommand command) {
           // ã€å¼ºåˆ¶ã€‘æ–¹æ³•ç»“æ„å¿…é¡»åŒ…å«ä»¥ä¸‹æ­¥éª¤ï¼š
           validateCommand(command);           // 1. å‚æ•°æ ¡éªŒ
           List<OrderItem> items = createOrderItems(command.getItems());  // 2. å­å¯¹è±¡åˆ›å»º
           Money totalAmount = calculateTotal(items);  // 3. ä¸šåŠ¡è®¡ç®—
           return buildOrder(command, items, totalAmount);  // 4. å¯¹è±¡ç»„è£…
       }
       
       // ã€å¼ºåˆ¶ã€‘ç§æœ‰æ–¹æ³•å¿…é¡»æŒ‰èŒè´£åˆ†ç¦»
       private void validateCommand(CreateOrderCommand command) {
           if (command == null || command.getUserId() == null) {
               throw new ProjectBizException(ErrorCode.INVALID_PARAMETER, "è®¢å•åˆ›å»ºå‚æ•°ä¸èƒ½ä¸ºç©º");
           }
           // å…·ä½“æ ¡éªŒé€»è¾‘
       }
       
       private List<OrderItem> createOrderItems(List<CreateOrderItemCommand> itemCommands) {
           return itemCommands.stream()
                   .map(this::createSingleOrderItem)
                   .collect(Collectors.toList());
       }
       
       private OrderItem createSingleOrderItem(CreateOrderItemCommand itemCommand) {
           Product product = productRepository.findById(itemCommand.getProductId())
                   .orElseThrow(() -> new ProjectBizException(ErrorCode.PRODUCT_NOT_FOUND));
           return new OrderItem(product, itemCommand.getQuantity());
       }
       
       private Money calculateTotal(List<OrderItem> items) {
           return pricingService.calculateTotalPrice(items);
       }
       
       private Order buildOrder(CreateOrderCommand command, List<OrderItem> items, Money totalAmount) {
           return Order.builder()
                   .userId(command.getUserId())
                   .items(items)
                   .totalAmount(totalAmount)
                   .status(OrderStatus.PENDING_PAYMENT)
                   .build();
       }
   }
   ```

2. **å·¥å‚æ–¹æ³•è¿”å›å€¼è§„èŒƒ**ï¼š
   - ã€å¼ºåˆ¶ã€‘å¿…é¡»è¿”å›é¢†åŸŸå¯¹è±¡ï¼Œä¸èƒ½è¿”å›DTO
   - ã€å¼ºåˆ¶ã€‘è¿”å›å¯¹è±¡å¿…é¡»æ˜¯å®Œæ•´çš„ã€å¯ç”¨çš„ä¸šåŠ¡å¯¹è±¡
   - ã€å¼ºåˆ¶ã€‘ä¸èƒ½è¿”å›åŠæˆå“å¯¹è±¡ï¼Œéœ€è¦è°ƒç”¨è€…ç»§ç»­ç»„è£…

## ä¸‰ã€ç­–ç•¥æ¨¡å¼ç²¾ç»†åŒ–è§„èŒƒ

### ã€å¼ºåˆ¶ã€‘ç­–ç•¥æ¨¡å¼é€‚ç”¨åœºæ™¯è¯†åˆ«
```
æç¤ºè¯ï¼š@codebase æ£€æŸ¥ä»¥ä¸‹åœºæ™¯æ˜¯å¦é€‚åˆä½¿ç”¨ç­–ç•¥æ¨¡å¼ï¼š
1. åŒä¸€ä¸ªä¸šåŠ¡è¡Œä¸ºæœ‰3ç§ä»¥ä¸Šä¸åŒç®—æ³•å®ç°
2. ç®—æ³•é€‰æ‹©é€»è¾‘å¤æ‚ï¼ŒåŒ…å«å¤šå±‚if-elseåˆ¤æ–­
3. ä¸åŒç®—æ³•çš„è¾“å…¥è¾“å‡ºæ ¼å¼ä¸€è‡´
4. ç®—æ³•éœ€è¦åœ¨è¿è¡Œæ—¶åŠ¨æ€é€‰æ‹©

å¦‚æœæ»¡è¶³3ä¸ªä»¥ä¸Šæ¡ä»¶ï¼Œå¿…é¡»ä½¿ç”¨ç­–ç•¥æ¨¡å¼
```

### ã€å¼ºåˆ¶ã€‘ç­–ç•¥æ¨¡å¼å®ç°è§„èŒƒ
1. **ç­–ç•¥æ¥å£è®¾è®¡è§„èŒƒ**ï¼š
   ```java
   // ã€å¼ºåˆ¶ã€‘ç­–ç•¥æ¥å£å‘½åï¼šä¸šåŠ¡è¡Œä¸º + Strategy
   public interface DiscountStrategy {
       
       // ã€å¼ºåˆ¶ã€‘æ–¹æ³•å‘½åï¼šåŠ¨è¯ + ä¸šåŠ¡å¯¹è±¡
       Money calculateDiscount(Order order, DiscountContext context);
       
       // ã€å¼ºåˆ¶ã€‘å¿…é¡»æä¾›ç­–ç•¥æ ‡è¯†æ–¹æ³•
       String getStrategyType();
       
       // ã€å¼ºåˆ¶ã€‘å¿…é¡»æä¾›é€‚ç”¨æ€§æ£€æŸ¥æ–¹æ³•
       boolean isApplicable(Order order, DiscountContext context);
   }
   ```

2. **ç­–ç•¥å®ç°ç±»è§„èŒƒ**ï¼š
   ```java
   // ã€å¼ºåˆ¶ã€‘å®ç°ç±»å‘½åï¼šå…·ä½“ç­–ç•¥å + Strategy
   @Component
   public class FixedAmountDiscountStrategy implements DiscountStrategy {
       
       // ã€å¼ºåˆ¶ã€‘ç­–ç•¥ç±»å‹å¸¸é‡
       public static final String STRATEGY_TYPE = "FIXED_AMOUNT";
       
       @Override
       public Money calculateDiscount(Order order, DiscountContext context) {
           // ã€å¼ºåˆ¶ã€‘å¿…é¡»å…ˆæ£€æŸ¥é€‚ç”¨æ€§
           if (!isApplicable(order, context)) {
               return Money.ZERO;
           }
           
           // ã€å¼ºåˆ¶ã€‘å…·ä½“ç®—æ³•å®ç°ï¼Œå¿…é¡»åŒ…å«ä¸šåŠ¡è§„åˆ™æ ¡éªŒ
           BigDecimal orderAmount = order.getTotalAmount().getAmount();
           BigDecimal discountAmount = context.getDiscountAmount();
           
           if (orderAmount.compareTo(context.getMinOrderAmount()) < 0) {
               throw new ProjectBizException(ErrorCode.DISCOUNT_NOT_APPLICABLE, 
                   "è®¢å•é‡‘é¢ä¸æ»¡è¶³æ»¡å‡æ¡ä»¶");
           }
           
           return new Money(discountAmount, order.getTotalAmount().getCurrency());
       }
       
       @Override
       public String getStrategyType() {
           return STRATEGY_TYPE;
       }
       
       @Override
       public boolean isApplicable(Order order, DiscountContext context) {
           return STRATEGY_TYPE.equals(context.getDiscountType()) 
               && order.getTotalAmount().getAmount().compareTo(context.getMinOrderAmount()) >= 0;
       }
   }
   ```

3. **ç­–ç•¥ç®¡ç†å™¨è§„èŒƒ**ï¼š
   ```java
   @Service
   @RequiredArgsConstructor
   public class DiscountStrategyManager {
       
       // ã€å¼ºåˆ¶ã€‘ä½¿ç”¨Mapç®¡ç†ç­–ç•¥ï¼Œkeyä¸ºç­–ç•¥ç±»å‹
       private final Map<String, DiscountStrategy> strategies;
       
       // ã€å¼ºåˆ¶ã€‘æ„é€ å™¨ä¸­åˆå§‹åŒ–ç­–ç•¥æ˜ å°„
       public DiscountStrategyManager(List<DiscountStrategy> strategyList) {
           this.strategies = strategyList.stream()
                   .collect(Collectors.toMap(
                       DiscountStrategy::getStrategyType,
                       Function.identity()
                   ));
       }
       
       // ã€å¼ºåˆ¶ã€‘ç­–ç•¥é€‰æ‹©æ–¹æ³•
       public Money applyDiscount(Order order, DiscountContext context) {
           DiscountStrategy strategy = strategies.get(context.getDiscountType());
           if (strategy == null) {
               throw new ProjectBizException(ErrorCode.UNSUPPORTED_DISCOUNT_TYPE, 
                   "ä¸æ”¯æŒçš„ä¼˜æƒ ç±»å‹: " + context.getDiscountType());
           }
           
           return strategy.calculateDiscount(order, context);
       }
   }
   ```

## å››ã€é€‚é…å™¨æ¨¡å¼ç²¾ç»†åŒ–è§„èŒƒ

### ã€å¼ºåˆ¶ã€‘é€‚é…å™¨æ¨¡å¼é€‚ç”¨åœºæ™¯
```
æç¤ºè¯ï¼š@codebase æ£€æŸ¥ä»¥ä¸‹åœºæ™¯æ˜¯å¦éœ€è¦ä½¿ç”¨é€‚é…å™¨æ¨¡å¼ï¼š
1. é›†æˆç¬¬ä¸‰æ–¹ç³»ç»Ÿï¼Œæ¥å£æ ¼å¼ä¸åŒ¹é…
2. æ–°è€ç³»ç»Ÿå¯¹æ¥ï¼Œæ•°æ®ç»“æ„å·®å¼‚è¾ƒå¤§
3. å¤šä¸ªå¤–éƒ¨æœåŠ¡æä¾›ç›¸åŒåŠŸèƒ½ä½†æ¥å£ä¸åŒ
4. éœ€è¦ç»Ÿä¸€å¤šç§æ•°æ®æºçš„è®¿é—®æ–¹å¼

å¦‚æœå­˜åœ¨ä»¥ä¸Šåœºæ™¯ï¼Œå¿…é¡»ä½¿ç”¨é€‚é…å™¨æ¨¡å¼
```

### ã€å¼ºåˆ¶ã€‘é€‚é…å™¨å®ç°è§„èŒƒ
1. **é€‚é…å™¨æ¥å£å®šä¹‰**ï¼š
   ```java
   // ã€å¼ºåˆ¶ã€‘å†…éƒ¨ç»Ÿä¸€æ¥å£ï¼Œéµå¾ªé¡¹ç›®ä¸šåŠ¡å‘½å
   public interface PaymentService {
       PaymentResult pay(PaymentRequest request);
       PaymentStatus queryPaymentStatus(String orderId);
       RefundResult refund(RefundRequest request);
   }
   ```

2. **é€‚é…å™¨å®ç°ç±»**ï¼š
   ```java
   @Service("alipayAdapter")  // ã€å¼ºåˆ¶ã€‘å¿…é¡»æŒ‡å®šBeanåç§°
   @RequiredArgsConstructor
   public class AlipayPaymentAdapter implements PaymentService {
       
       private final AlipayClient alipayClient;  // ç¬¬ä¸‰æ–¹SDK
       
       @Override
       public PaymentResult pay(PaymentRequest request) {
           try {
               // ã€å¼ºåˆ¶ã€‘ç¬¬ä¸€æ­¥ï¼šå‚æ•°æ ¡éªŒ
               validatePaymentRequest(request);
               
               // ã€å¼ºåˆ¶ã€‘ç¬¬äºŒæ­¥ï¼šæ•°æ®è½¬æ¢
               AlipayTradeAppPayRequest alipayRequest = convertToAlipayRequest(request);
               
               // ã€å¼ºåˆ¶ã€‘ç¬¬ä¸‰æ­¥ï¼šè°ƒç”¨ç¬¬ä¸‰æ–¹æ¥å£
               AlipayTradeAppPayResponse alipayResponse = alipayClient.execute(alipayRequest);
               
               // ã€å¼ºåˆ¶ã€‘ç¬¬å››æ­¥ï¼šç»“æœè½¬æ¢
               return convertToPaymentResult(alipayResponse, request);
               
           } catch (AlipayApiException e) {
               // ã€å¼ºåˆ¶ã€‘å¿…é¡»è½¬æ¢ä¸ºé¡¹ç›®å†…éƒ¨å¼‚å¸¸
               log.error("æ”¯ä»˜å®æ”¯ä»˜è°ƒç”¨å¤±è´¥ï¼Œè®¢å•å·ï¼š{}", request.getOrderId(), e);
               throw new ProjectBizException(ErrorCode.THIRD_PARTY_PAYMENT_FAILED, 
                   "æ”¯ä»˜å®æ”¯ä»˜å¤±è´¥: " + e.getErrMsg(), e);
           }
       }
       
       // ã€å¼ºåˆ¶ã€‘å‚æ•°æ ¡éªŒæ–¹æ³•
       private void validatePaymentRequest(PaymentRequest request) {
           if (request == null || StringUtils.isBlank(request.getOrderId())) {
               throw new ProjectBizException(ErrorCode.INVALID_PARAMETER, "æ”¯ä»˜è¯·æ±‚å‚æ•°æ— æ•ˆ");
           }
           if (request.getAmount() == null || request.getAmount().compareTo(BigDecimal.ZERO) <= 0) {
               throw new ProjectBizException(ErrorCode.INVALID_PARAMETER, "æ”¯ä»˜é‡‘é¢æ— æ•ˆ");
           }
       }
       
       // ã€å¼ºåˆ¶ã€‘è¯·æ±‚è½¬æ¢æ–¹æ³•
       private AlipayTradeAppPayRequest convertToAlipayRequest(PaymentRequest request) {
           AlipayTradeAppPayModel model = new AlipayTradeAppPayModel();
           model.setOutTradeNo(request.getOrderId());
           model.setSubject(request.getSubject());
           model.setTotalAmount(request.getAmount().toString());
           model.setProductCode("QUICK_MSECURITY_PAY");
           
           AlipayTradeAppPayRequest alipayRequest = new AlipayTradeAppPayRequest();
           alipayRequest.setBizModel(model);
           alipayRequest.setNotifyUrl(request.getNotifyUrl());
           
           return alipayRequest;
       }
       
       // ã€å¼ºåˆ¶ã€‘å“åº”è½¬æ¢æ–¹æ³•
       private PaymentResult convertToPaymentResult(AlipayTradeAppPayResponse response, PaymentRequest request) {
           if (!response.isSuccess()) {
               throw new ProjectBizException(ErrorCode.THIRD_PARTY_PAYMENT_FAILED, 
                   "æ”¯ä»˜å®è¿”å›å¤±è´¥: " + response.getSubMsg());
           }
           
           return PaymentResult.builder()
                   .orderId(request.getOrderId())
                   .paymentId(response.getTradeNo())
                   .status(PaymentStatus.SUCCESS)
                   .paymentData(response.getBody())
                   .build();
       }
   }
   ```

## äº”ã€å»ºé€ è€…æ¨¡å¼ç²¾ç»†åŒ–è§„èŒƒ

### ã€å¼ºåˆ¶ã€‘å»ºé€ è€…æ¨¡å¼é€‚ç”¨åœºæ™¯
```
æç¤ºè¯ï¼š@codebase æ£€æŸ¥å¯¹è±¡åˆ›å»ºæ˜¯å¦éœ€è¦å»ºé€ è€…æ¨¡å¼ï¼š
1. æ„é€ å‚æ•°è¶…è¿‡5ä¸ª
2. æœ‰å¤šä¸ªå¯é€‰å‚æ•°ç»„åˆ
3. å¯¹è±¡åˆ›å»ºéœ€è¦å¤šä¸ªæ­¥éª¤ä¸”é¡ºåºé‡è¦
4. éœ€è¦åˆ›å»ºä¸åŒé…ç½®çš„åŒç±»å¯¹è±¡

å¦‚æœæ»¡è¶³2ä¸ªä»¥ä¸Šæ¡ä»¶ï¼Œæ¨èä½¿ç”¨å»ºé€ è€…æ¨¡å¼
```

### ã€å¼ºåˆ¶ã€‘å»ºé€ è€…å®ç°è§„èŒƒ
1. **Lombok Builderä½¿ç”¨è§„èŒƒ**ï¼š
   ```java
   @Data
   @Builder
   @NoArgsConstructor
   @AllArgsConstructor(access = AccessLevel.PRIVATE)  // ã€å¼ºåˆ¶ã€‘ç§æœ‰æ„é€ å™¨
   public class UserProfile {
       
       // ã€å¼ºåˆ¶ã€‘å¿…å¡«å­—æ®µä¸èƒ½æœ‰é»˜è®¤å€¼
       @NonNull
       private Long userId;
       
       @NonNull
       private String username;
       
       // ã€å¼ºåˆ¶ã€‘å¯é€‰å­—æ®µå¿…é¡»æœ‰é»˜è®¤å€¼
       @Builder.Default
       private String nickname = "";
       
       @Builder.Default
       private String avatar = "default_avatar.png";
       
       @Builder.Default
       private UserStatus status = UserStatus.ACTIVE;
       
       // ã€å¼ºåˆ¶ã€‘è‡ªå®šä¹‰Builderæ–¹æ³•ç”¨äºå¤æ‚æ ¡éªŒ
       public static class UserProfileBuilder {
           public UserProfileBuilder withValidatedEmail(String email) {
               if (!EmailValidator.isValid(email)) {
                   throw new ProjectBizException(ErrorCode.INVALID_EMAIL_FORMAT);
               }
               this.email = email;
               return this;
           }
           
           public UserProfile build() {
               // ã€å¼ºåˆ¶ã€‘æ„å»ºå‰æœ€ç»ˆæ ¡éªŒ
               if (userId == null || username == null) {
                   throw new ProjectBizException(ErrorCode.REQUIRED_FIELD_MISSING, 
                       "ç”¨æˆ·IDå’Œç”¨æˆ·åä¸ºå¿…å¡«å­—æ®µ");
               }
               return new UserProfile(userId, username, nickname, avatar, status);
           }
       }
   }
   ```

## å…­ã€è§‚å¯Ÿè€…æ¨¡å¼ç²¾ç»†åŒ–è§„èŒƒ

### ã€å¼ºåˆ¶ã€‘è§‚å¯Ÿè€…æ¨¡å¼å®ç°è§„èŒƒ
1. **äº‹ä»¶å®šä¹‰è§„èŒƒ**ï¼š
   ```java
   // ã€å¼ºåˆ¶ã€‘äº‹ä»¶ç±»å‘½åï¼šä¸šåŠ¡å¯¹è±¡ + ä¸šåŠ¡åŠ¨ä½œ + Event
   @Data
   @AllArgsConstructor
   public class OrderPaymentSuccessEvent {
       
       // ã€å¼ºåˆ¶ã€‘å¿…é¡»åŒ…å«ä¸šåŠ¡æ ‡è¯†
       private final Long orderId;
       private final Long userId;
       
       // ã€å¼ºåˆ¶ã€‘å¿…é¡»åŒ…å«æ—¶é—´æˆ³
       private final LocalDateTime occurredAt;
       
       // ã€å¼ºåˆ¶ã€‘å¿…é¡»åŒ…å«ä¸šåŠ¡æ•°æ®
       private final Money paymentAmount;
       private final String paymentMethod;
       
       // ã€å¼ºåˆ¶ã€‘å¯é€‰çš„ä¸Šä¸‹æ–‡ä¿¡æ¯
       private final Map<String, Object> eventContext;
   }
   ```

2. **äº‹ä»¶å‘å¸ƒè§„èŒƒ**ï¼š
   ```java
   @Service
   @RequiredArgsConstructor
   public class PaymentServiceImpl implements PaymentService {
       
       private final ApplicationEventPublisher eventPublisher;
       
       @Transactional(rollbackFor = Exception.class)
       public void processPayment(PaymentCommand command) {
           // ä¸šåŠ¡å¤„ç†...
           
           // ã€å¼ºåˆ¶ã€‘äº‹ä»¶å‘å¸ƒå¿…é¡»åœ¨äº‹åŠ¡æäº¤å‰
           OrderPaymentSuccessEvent event = new OrderPaymentSuccessEvent(
               command.getOrderId(),
               command.getUserId(),
               LocalDateTime.now(),
               command.getAmount(),
               command.getPaymentMethod(),
               buildEventContext(command)
           );
           
           eventPublisher.publishEvent(event);
           
           log.info("æ”¯ä»˜æˆåŠŸäº‹ä»¶å·²å‘å¸ƒï¼Œè®¢å•å·ï¼š{}", command.getOrderId());
       }
       
       private Map<String, Object> buildEventContext(PaymentCommand command) {
           Map<String, Object> context = new HashMap<>();
           context.put("source", "PaymentService");
           context.put("version", "1.0");
           return context;
       }
   }
   ```

3. **äº‹ä»¶ç›‘å¬è§„èŒƒ**ï¼š
   ```java
   @Component
   @Slf4j
   public class OrderStatusEventListener {
       
       @EventListener
       @Async("eventTaskExecutor")  // ã€å¼ºåˆ¶ã€‘å¼‚æ­¥å¤„ç†ï¼ŒæŒ‡å®šçº¿ç¨‹æ± 
       @Transactional(propagation = Propagation.REQUIRES_NEW)  // ã€å¼ºåˆ¶ã€‘æ–°äº‹åŠ¡
       public void handlePaymentSuccess(OrderPaymentSuccessEvent event) {
           try {
               // ã€å¼ºåˆ¶ã€‘è®°å½•äº‹ä»¶å¤„ç†å¼€å§‹
               log.info("å¤„ç†æ”¯ä»˜æˆåŠŸäº‹ä»¶ï¼Œè®¢å•å·ï¼š{}", event.getOrderId());
               
               // å…·ä½“ä¸šåŠ¡å¤„ç†
               updateOrderStatus(event.getOrderId(), OrderStatus.PAID);
               sendPaymentNotification(event.getUserId(), event.getOrderId());
               
               // ã€å¼ºåˆ¶ã€‘è®°å½•äº‹ä»¶å¤„ç†å®Œæˆ
               log.info("æ”¯ä»˜æˆåŠŸäº‹ä»¶å¤„ç†å®Œæˆï¼Œè®¢å•å·ï¼š{}", event.getOrderId());
               
           } catch (Exception e) {
               // ã€å¼ºåˆ¶ã€‘å¼‚å¸¸å¤„ç†å’Œæ—¥å¿—è®°å½•
               log.error("å¤„ç†æ”¯ä»˜æˆåŠŸäº‹ä»¶å¤±è´¥ï¼Œè®¢å•å·ï¼š{}", event.getOrderId(), e);
               // ã€å¼ºåˆ¶ã€‘ä¸èƒ½æŠ›å‡ºå¼‚å¸¸ï¼Œé¿å…å½±å“å…¶ä»–ç›‘å¬å™¨
           }
       }
       
       private void updateOrderStatus(Long orderId, OrderStatus status) {
           // å…·ä½“å®ç°
       }
       
       private void sendPaymentNotification(Long userId, Long orderId) {
           // å…·ä½“å®ç°
       }
   }
   ```

## ä¸ƒã€æ¨¡æ¿æ–¹æ³•æ¨¡å¼ç²¾ç»†åŒ–è§„èŒƒ

### ã€å¼ºåˆ¶ã€‘æ¨¡æ¿æ–¹æ³•æ¨¡å¼é€‚ç”¨åœºæ™¯
```
æç¤ºè¯ï¼š@codebase æ£€æŸ¥ä»¥ä¸‹åœºæ™¯æ˜¯å¦é€‚åˆä½¿ç”¨æ¨¡æ¿æ–¹æ³•æ¨¡å¼ï¼š
1. å¤šä¸ªç±»æœ‰ç›¸åŒçš„å¤„ç†æµç¨‹ä½†æŸäº›æ­¥éª¤å®ç°ä¸åŒ
2. éœ€è¦æ§åˆ¶å­ç±»çš„æ‰©å±•ç‚¹
3. æœ‰æ˜ç¡®çš„ç®—æ³•éª¨æ¶ä¸”æ­¥éª¤é¡ºåºå›ºå®š
4. å¸Œæœ›é¿å…ä»£ç é‡å¤

å¦‚æœæ»¡è¶³3ä¸ªä»¥ä¸Šæ¡ä»¶ï¼Œå¿…é¡»ä½¿ç”¨æ¨¡æ¿æ–¹æ³•æ¨¡å¼
```

### ã€å¼ºåˆ¶ã€‘æ¨¡æ¿æ–¹æ³•å®ç°è§„èŒƒ
1. **æŠ½è±¡æ¨¡æ¿ç±»è§„èŒƒ**ï¼š
   ```java
   // ã€å¼ºåˆ¶ã€‘æŠ½è±¡ç±»å‘½åï¼šAbstract + ä¸šåŠ¡åç§° + Template
   public abstract class AbstractDataProcessorTemplate {
       
       // ã€å¼ºåˆ¶ã€‘æ¨¡æ¿æ–¹æ³•å¿…é¡»ä¸ºfinalï¼Œä¸å…è®¸å­ç±»é‡å†™
       public final ProcessResult processData(DataInput input) {
           // ã€å¼ºåˆ¶ã€‘å›ºå®šçš„å¤„ç†æµç¨‹
           validateInput(input);                    // 1. è¾“å…¥æ ¡éªŒ
           RawData rawData = extractData(input);    // 2. æ•°æ®æå–ï¼ˆæŠ½è±¡ï¼‰
           CleanData cleanData = cleanData(rawData); // 3. æ•°æ®æ¸…æ´—ï¼ˆæŠ½è±¡ï¼‰
           ProcessedData processedData = transformData(cleanData); // 4. æ•°æ®è½¬æ¢ï¼ˆæŠ½è±¡ï¼‰
           ProcessResult result = saveData(processedData); // 5. æ•°æ®ä¿å­˜ï¼ˆæŠ½è±¡ï¼‰
           afterProcess(result);                    // 6. åç½®å¤„ç†ï¼ˆé’©å­æ–¹æ³•ï¼‰
           return result;
       }
       
       // ã€å¼ºåˆ¶ã€‘é€šç”¨æ­¥éª¤åœ¨çˆ¶ç±»å®ç°
       private void validateInput(DataInput input) {
           if (input == null || input.getData() == null) {
               throw new ProjectBizException(ErrorCode.INVALID_INPUT, "è¾“å…¥æ•°æ®ä¸èƒ½ä¸ºç©º");
           }
       }
       
       // ã€å¼ºåˆ¶ã€‘æŠ½è±¡æ–¹æ³•ï¼šå­ç±»å¿…é¡»å®ç°çš„æ­¥éª¤
       protected abstract RawData extractData(DataInput input);
       protected abstract CleanData cleanData(RawData rawData);
       protected abstract ProcessedData transformData(CleanData cleanData);
       protected abstract ProcessResult saveData(ProcessedData processedData);
       
       // ã€å¼ºåˆ¶ã€‘é’©å­æ–¹æ³•ï¼šå­ç±»å¯é€‰æ‹©å®ç°
       protected void afterProcess(ProcessResult result) {
           log.info("æ•°æ®å¤„ç†å®Œæˆï¼Œå¤„ç†ç»“æœï¼š{}", result.getStatus());
       }
   }
   ```

2. **å…·ä½“å®ç°ç±»è§„èŒƒ**ï¼š
   ```java
   @Component
   public class CsvDataProcessor extends AbstractDataProcessorTemplate {
       
       @Override
       protected RawData extractData(DataInput input) {
           // ã€å¼ºåˆ¶ã€‘å¿…é¡»åŒ…å«å…·ä½“å®ç°é€»è¾‘
           if (!(input instanceof CsvDataInput)) {
               throw new ProjectBizException(ErrorCode.UNSUPPORTED_INPUT_TYPE, 
                   "CSVå¤„ç†å™¨åªæ”¯æŒCSVè¾“å…¥");
           }
           
           CsvDataInput csvInput = (CsvDataInput) input;
           return csvParser.parse(csvInput.getFilePath());
       }
       
       @Override
       protected CleanData cleanData(RawData rawData) {
           // CSVç‰¹å®šçš„æ•°æ®æ¸…æ´—é€»è¾‘
           return csvDataCleaner.clean(rawData);
       }
       
       // å…¶ä»–æŠ½è±¡æ–¹æ³•å®ç°...
   }
   ```

## å…«ã€è´£ä»»é“¾æ¨¡å¼ç²¾ç»†åŒ–è§„èŒƒ

### ã€å¼ºåˆ¶ã€‘è´£ä»»é“¾æ¨¡å¼é€‚ç”¨åœºæ™¯
```
æç¤ºè¯ï¼š@codebase æ£€æŸ¥ä»¥ä¸‹åœºæ™¯æ˜¯å¦é€‚åˆä½¿ç”¨è´£ä»»é“¾æ¨¡å¼ï¼š
1. æœ‰å¤šä¸ªå¯¹è±¡å¯ä»¥å¤„ç†åŒä¸€è¯·æ±‚
2. å¤„ç†è€…çš„é¡ºåºéœ€è¦åŠ¨æ€é…ç½®
3. è¯·æ±‚çš„å¤„ç†è¿‡ç¨‹éœ€è¦è®°å½•æˆ–ç›‘æ§
4. å¸Œæœ›å‘é€è€…ä¸æ¥æ”¶è€…è§£è€¦

å¦‚æœæ»¡è¶³3ä¸ªä»¥ä¸Šæ¡ä»¶ï¼Œå¿…é¡»ä½¿ç”¨è´£ä»»é“¾æ¨¡å¼
```

### ã€å¼ºåˆ¶ã€‘è´£ä»»é“¾å®ç°è§„èŒƒ
1. **æŠ½è±¡å¤„ç†è€…è§„èŒƒ**ï¼š
   ```java
   // ã€å¼ºåˆ¶ã€‘å¤„ç†è€…åŸºç±»å‘½åï¼šAbstract + ä¸šåŠ¡åç§° + Handler
   public abstract class AbstractValidationHandler {
       
       protected AbstractValidationHandler nextHandler;
       
       // ã€å¼ºåˆ¶ã€‘è®¾ç½®ä¸‹ä¸€ä¸ªå¤„ç†è€…
       public void setNextHandler(AbstractValidationHandler nextHandler) {
           this.nextHandler = nextHandler;
       }
       
       // ã€å¼ºåˆ¶ã€‘æ¨¡æ¿æ–¹æ³•ï¼šç»Ÿä¸€çš„å¤„ç†æµç¨‹
       public final ValidationResult handle(ValidationRequest request) {
           try {
               // å½“å‰å¤„ç†è€…å¤„ç†
               ValidationResult result = doHandle(request);
               
               // å¦‚æœå¤„ç†å¤±è´¥ä¸”æœ‰ä¸‹ä¸€ä¸ªå¤„ç†è€…ï¼Œç»§ç»­å¤„ç†
               if (!result.isSuccess() && nextHandler != null) {
                   return nextHandler.handle(request);
               }
               
               return result;
               
           } catch (Exception e) {
               log.error("éªŒè¯å¤„ç†å¤±è´¥ï¼š{}", getHandlerName(), e);
               return ValidationResult.failure(ErrorCode.VALIDATION_ERROR, e.getMessage());
           }
       }
       
       // ã€å¼ºåˆ¶ã€‘æŠ½è±¡æ–¹æ³•ï¼šå…·ä½“å¤„ç†é€»è¾‘
       protected abstract ValidationResult doHandle(ValidationRequest request);
       
       // ã€å¼ºåˆ¶ã€‘æŠ½è±¡æ–¹æ³•ï¼šå¤„ç†è€…åç§°ï¼ˆç”¨äºæ—¥å¿—ï¼‰
       protected abstract String getHandlerName();
   }
   ```

2. **å…·ä½“å¤„ç†è€…è§„èŒƒ**ï¼š
   ```java
   @Component
   public class ParameterValidationHandler extends AbstractValidationHandler {
       
       @Override
       protected ValidationResult doHandle(ValidationRequest request) {
           if (request.getParameters() == null || request.getParameters().isEmpty()) {
               return ValidationResult.failure(ErrorCode.MISSING_PARAMETERS, "ç¼ºå°‘å¿…è¦å‚æ•°");
           }
           
           // å‚æ•°æ ¼å¼æ ¡éªŒ
           for (Map.Entry<String, Object> entry : request.getParameters().entrySet()) {
               if (!isValidParameter(entry.getKey(), entry.getValue())) {
                   return ValidationResult.failure(ErrorCode.INVALID_PARAMETER, 
                       "å‚æ•°æ ¼å¼é”™è¯¯: " + entry.getKey());
               }
           }
           
           return ValidationResult.success();
       }
       
       @Override
       protected String getHandlerName() {
           return "å‚æ•°éªŒè¯å¤„ç†å™¨";
       }
       
       private boolean isValidParameter(String key, Object value) {
           // å…·ä½“å‚æ•°æ ¡éªŒé€»è¾‘
           return true;
       }
   }
   ```

3. **è´£ä»»é“¾ç®¡ç†å™¨è§„èŒƒ**ï¼š
   ```java
   @Service
   @RequiredArgsConstructor
   public class ValidationChainManager {
       
       private final List<AbstractValidationHandler> handlers;
       
       @PostConstruct
       public void initChain() {
           // ã€å¼ºåˆ¶ã€‘æŒ‰é¡ºåºæ„å»ºè´£ä»»é“¾
           for (int i = 0; i < handlers.size() - 1; i++) {
               handlers.get(i).setNextHandler(handlers.get(i + 1));
           }
       }
       
       public ValidationResult validate(ValidationRequest request) {
           if (handlers.isEmpty()) {
               throw new ProjectBizException(ErrorCode.NO_VALIDATION_HANDLER, "æ²¡æœ‰å¯ç”¨çš„éªŒè¯å¤„ç†å™¨");
           }
           
           return handlers.get(0).handle(request);
       }
   }
   ```

## ä¹ã€å•ä¾‹æ¨¡å¼ç²¾ç»†åŒ–è§„èŒƒ

### ã€å¼ºåˆ¶ã€‘å•ä¾‹æ¨¡å¼é€‚ç”¨åœºæ™¯
```
æç¤ºè¯ï¼š@codebase æ£€æŸ¥ä»¥ä¸‹åœºæ™¯æ˜¯å¦éœ€è¦ä½¿ç”¨å•ä¾‹æ¨¡å¼ï¼š
1. å…¨å±€åªèƒ½æœ‰ä¸€ä¸ªå®ä¾‹çš„èµ„æºï¼ˆå¦‚é…ç½®ç®¡ç†å™¨ï¼‰
2. åˆ›å»ºæˆæœ¬å¾ˆé«˜çš„å¯¹è±¡ï¼ˆå¦‚æ•°æ®åº“è¿æ¥æ± ï¼‰
3. æ— çŠ¶æ€çš„å·¥å…·ç±»
4. ç³»ç»Ÿçº§çš„æœåŠ¡ç»„ä»¶

æ³¨æ„ï¼šSpringç¯å¢ƒä¸‹ä¼˜å…ˆä½¿ç”¨@Componentå•ä¾‹ç®¡ç†
```

### ã€å¼ºåˆ¶ã€‘å•ä¾‹å®ç°è§„èŒƒ
1. **æšä¸¾å•ä¾‹ï¼ˆæ¨èï¼‰**ï¼š
   ```java
   // ã€å¼ºåˆ¶ã€‘çº¿ç¨‹å®‰å…¨çš„å•ä¾‹å®ç°
   public enum ConfigurationManager {
       INSTANCE;
       
       private final Map<String, String> configurations = new ConcurrentHashMap<>();
       
       public void setConfiguration(String key, String value) {
           configurations.put(key, value);
       }
       
       public String getConfiguration(String key) {
           return configurations.get(key);
       }
       
       public String getConfiguration(String key, String defaultValue) {
           return configurations.getOrDefault(key, defaultValue);
       }
   }
   
   // ä½¿ç”¨æ–¹å¼
   // ConfigurationManager.INSTANCE.setConfiguration("key", "value");
   ```

2. **Springç®¡ç†å•ä¾‹ï¼ˆæ¨èï¼‰**ï¼š
   ```java
   @Component
   @Scope("singleton")  // é»˜è®¤å°±æ˜¯å•ä¾‹ï¼Œå¯ä»¥çœç•¥
   public class SystemConfigurationService {
       
       private final Map<String, Object> cache = new ConcurrentHashMap<>();
       
       @PostConstruct
       public void init() {
           loadConfigurations();
       }
       
       private void loadConfigurations() {
           // åŠ è½½é…ç½®é€»è¾‘
       }
   }
   ```

## åã€è£…é¥°å™¨æ¨¡å¼ç²¾ç»†åŒ–è§„èŒƒ

### ã€å¼ºåˆ¶ã€‘è£…é¥°å™¨æ¨¡å¼é€‚ç”¨åœºæ™¯
```
æç¤ºè¯ï¼š@codebase æ£€æŸ¥ä»¥ä¸‹åœºæ™¯æ˜¯å¦é€‚åˆä½¿ç”¨è£…é¥°å™¨æ¨¡å¼ï¼š
1. éœ€è¦åŠ¨æ€ç»™å¯¹è±¡æ·»åŠ åŠŸèƒ½
2. åŠŸèƒ½ç»„åˆéœ€è¦çµæ´»é…ç½®
3. ä¸é€‚åˆä½¿ç”¨ç»§æ‰¿æ‰©å±•åŠŸèƒ½
4. éœ€è¦é€æ˜åœ°å¢å¼ºç°æœ‰å¯¹è±¡

ä¼˜å…ˆè€ƒè™‘Spring AOPï¼Œè£…é¥°å™¨æ¨¡å¼ç”¨äºç‰¹æ®Šåœºæ™¯
```

### ã€å¼ºåˆ¶ã€‘è£…é¥°å™¨å®ç°è§„èŒƒ
1. **ç»„ä»¶æ¥å£è§„èŒƒ**ï¼š
   ```java
   public interface MessageSender {
       void sendMessage(Message message);
   }
   ```

2. **å…·ä½“ç»„ä»¶è§„èŒƒ**ï¼š
   ```java
   @Component("basicMessageSender")
   public class BasicMessageSender implements MessageSender {
       
       @Override
       public void sendMessage(Message message) {
           // åŸºç¡€å‘é€é€»è¾‘
           log.info("å‘é€æ¶ˆæ¯ï¼š{}", message.getContent());
           // å®é™…å‘é€å®ç°
       }
   }
   ```

3. **è£…é¥°å™¨åŸºç±»è§„èŒƒ**ï¼š
   ```java
   public abstract class MessageSenderDecorator implements MessageSender {
       
       protected final MessageSender delegate;
       
       public MessageSenderDecorator(MessageSender delegate) {
           this.delegate = Objects.requireNonNull(delegate, "å§”æ‰˜å¯¹è±¡ä¸èƒ½ä¸ºç©º");
       }
       
       @Override
       public void sendMessage(Message message) {
           delegate.sendMessage(message);
       }
   }
   ```

4. **å…·ä½“è£…é¥°å™¨è§„èŒƒ**ï¼š
   ```java
   @Component
   public class EncryptionMessageDecorator extends MessageSenderDecorator {
       
       private final EncryptionService encryptionService;
       
       public EncryptionMessageDecorator(
           @Qualifier("basicMessageSender") MessageSender delegate,
           EncryptionService encryptionService) {
           super(delegate);
           this.encryptionService = encryptionService;
       }
       
       @Override
       public void sendMessage(Message message) {
           // ã€å¼ºåˆ¶ã€‘å‰ç½®å¢å¼º
           Message encryptedMessage = encryptMessage(message);
           
           // è°ƒç”¨å§”æ‰˜å¯¹è±¡
           super.sendMessage(encryptedMessage);
           
           // ã€å¼ºåˆ¶ã€‘åç½®å¤„ç†ï¼ˆå¦‚éœ€è¦ï¼‰
           log.info("æ¶ˆæ¯åŠ å¯†å‘é€å®Œæˆ");
       }
       
       private Message encryptMessage(Message message) {
           String encryptedContent = encryptionService.encrypt(message.getContent());
           return message.withContent(encryptedContent);
       }
   }
   ```

## åä¸€ã€å‘½ä»¤æ¨¡å¼ç²¾ç»†åŒ–è§„èŒƒ

### ã€å¼ºåˆ¶ã€‘å‘½ä»¤æ¨¡å¼é€‚ç”¨åœºæ™¯
```
æç¤ºè¯ï¼š@codebase æ£€æŸ¥ä»¥ä¸‹åœºæ™¯æ˜¯å¦é€‚åˆä½¿ç”¨å‘½ä»¤æ¨¡å¼ï¼š
1. éœ€è¦å°†è¯·æ±‚å°è£…ä¸ºå¯¹è±¡ï¼ˆæ”¯æŒæ’¤é”€ã€é‡åšï¼‰
2. éœ€è¦æ”¯æŒäº‹åŠ¡å’Œæ‰¹å¤„ç†
3. éœ€è¦è®°å½•æ“ä½œæ—¥å¿—
4. éœ€è¦æ”¯æŒå¼‚æ­¥æ‰§è¡Œ

å¦‚æœæ»¡è¶³2ä¸ªä»¥ä¸Šæ¡ä»¶ï¼Œæ¨èä½¿ç”¨å‘½ä»¤æ¨¡å¼
```

### ã€å¼ºåˆ¶ã€‘å‘½ä»¤æ¨¡å¼å®ç°è§„èŒƒ
1. **å‘½ä»¤æ¥å£è§„èŒƒ**ï¼š
   ```java
   public interface Command {
       
       // ã€å¼ºåˆ¶ã€‘æ‰§è¡Œå‘½ä»¤
       CommandResult execute();
       
       // ã€å¼ºåˆ¶ã€‘æ’¤é”€å‘½ä»¤ï¼ˆå¦‚æ”¯æŒï¼‰
       CommandResult undo();
       
       // ã€å¼ºåˆ¶ã€‘å‘½ä»¤æ ‡è¯†
       String getCommandId();
       
       // ã€å¼ºåˆ¶ã€‘å‘½ä»¤æè¿°
       String getDescription();
       
       // ã€å¼ºåˆ¶ã€‘æ˜¯å¦æ”¯æŒæ’¤é”€
       boolean isUndoable();
   }
   ```

2. **å…·ä½“å‘½ä»¤è§„èŒƒ**ï¼š
   ```java
   public class CreateOrderCommand implements Command {
       
       private final String commandId;
       private final OrderService orderService;
       private final CreateOrderRequest request;
       private Long createdOrderId; // ç”¨äºæ’¤é”€
       
       public CreateOrderCommand(OrderService orderService, CreateOrderRequest request) {
           this.commandId = UUID.randomUUID().toString();
           this.orderService = Objects.requireNonNull(orderService);
           this.request = Objects.requireNonNull(request);
       }
       
       @Override
       public CommandResult execute() {
           try {
               Order order = orderService.createOrder(request);
               this.createdOrderId = order.getId();
               
               return CommandResult.success(commandId, "è®¢å•åˆ›å»ºæˆåŠŸ", order);
               
           } catch (Exception e) {
               log.error("åˆ›å»ºè®¢å•å‘½ä»¤æ‰§è¡Œå¤±è´¥ï¼š{}", commandId, e);
               return CommandResult.failure(commandId, "è®¢å•åˆ›å»ºå¤±è´¥", e);
           }
       }
       
       @Override
       public CommandResult undo() {
           if (!isUndoable() || createdOrderId == null) {
               return CommandResult.failure(commandId, "å‘½ä»¤ä¸æ”¯æŒæ’¤é”€æˆ–æœªæ‰§è¡Œ");
           }
           
           try {
               orderService.cancelOrder(createdOrderId);
               return CommandResult.success(commandId, "è®¢å•åˆ›å»ºå·²æ’¤é”€");
               
           } catch (Exception e) {
               log.error("æ’¤é”€åˆ›å»ºè®¢å•å‘½ä»¤å¤±è´¥ï¼š{}", commandId, e);
               return CommandResult.failure(commandId, "æ’¤é”€å¤±è´¥", e);
           }
       }
       
       @Override
       public String getCommandId() {
           return commandId;
       }
       
       @Override
       public String getDescription() {
           return "åˆ›å»ºè®¢å•ï¼šç”¨æˆ·ID=" + request.getUserId();
       }
       
       @Override
       public boolean isUndoable() {
           return true;
       }
   }
   ```

3. **å‘½ä»¤è°ƒç”¨è€…è§„èŒƒ**ï¼š
   ```java
   @Service
   public class CommandInvoker {
       
       private final Stack<Command> executedCommands = new Stack<>();
       private final CommandAuditService auditService;
       
       public CommandResult executeCommand(Command command) {
           // ã€å¼ºåˆ¶ã€‘è®°å½•å‘½ä»¤æ‰§è¡Œ
           auditService.recordCommandStart(command);
           
           try {
               CommandResult result = command.execute();
               
               if (result.isSuccess() && command.isUndoable()) {
                   executedCommands.push(command);
               }
               
               // ã€å¼ºåˆ¶ã€‘è®°å½•æ‰§è¡Œç»“æœ
               auditService.recordCommandResult(command, result);
               
               return result;
               
           } catch (Exception e) {
               log.error("å‘½ä»¤æ‰§è¡Œå¼‚å¸¸ï¼š{}", command.getCommandId(), e);
               CommandResult errorResult = CommandResult.failure(command.getCommandId(), "æ‰§è¡Œå¼‚å¸¸", e);
               auditService.recordCommandResult(command, errorResult);
               return errorResult;
           }
       }
       
       public CommandResult undoLastCommand() {
           if (executedCommands.isEmpty()) {
               return CommandResult.failure("", "æ²¡æœ‰å¯æ’¤é”€çš„å‘½ä»¤");
           }
           
           Command lastCommand = executedCommands.pop();
           return lastCommand.undo();
       }
   }
   ```

## åäºŒã€Cursoræ™ºèƒ½è¾…åŠ©ä¸è§„èŒƒæ£€æŸ¥

### ã€æ¨èã€‘è®¾è®¡æ¨¡å¼æ™ºèƒ½é€‰æ‹©
```
æç¤ºè¯æ¨¡æ¿ï¼š
@codebase åˆ†æè¿™æ®µä»£ç ï¼Œç¡®å®šæ˜¯å¦éœ€è¦åº”ç”¨è®¾è®¡æ¨¡å¼ï¼š
[ç²˜è´´å¾…åˆ†æä»£ç ]

è¯·æŒ‰ä»¥ä¸‹æ ‡å‡†åˆ†æï¼š
1. ä»£ç å¤æ‚åº¦è¯„ä¼°ï¼ˆåœˆå¤æ‚åº¦ã€åˆ†æ”¯æ•°é‡ï¼‰
2. é‡å¤ä»£ç è¯†åˆ«
3. æ‰©å±•ç‚¹åˆ†æ
4. æ¨èçš„å…·ä½“è®¾è®¡æ¨¡å¼
5. é¢„æœŸæ”¹è¿›æ•ˆæœ

åªæœ‰åœ¨æ˜ç¡®èƒ½å¸¦æ¥ä»·å€¼æ—¶æ‰æ¨èå¼•å…¥è®¾è®¡æ¨¡å¼ã€‚
```

### ã€æ¨èã€‘è®¾è®¡æ¨¡å¼å®ç°æ£€æŸ¥
```
æç¤ºè¯æ¨¡æ¿ï¼š
@codebase æ£€æŸ¥è¿™ä¸ªè®¾è®¡æ¨¡å¼å®ç°æ˜¯å¦ç¬¦åˆè§„èŒƒï¼š
[ç²˜è´´è®¾è®¡æ¨¡å¼å®ç°ä»£ç ]

æ£€æŸ¥æ ‡å‡†ï¼š
1. å‘½åè§„èŒƒæ˜¯å¦æ­£ç¡®
2. ç»“æ„æ˜¯å¦å®Œæ•´
3. å¼‚å¸¸å¤„ç†æ˜¯å¦åˆ°ä½
4. æ˜¯å¦å­˜åœ¨è¿‡åº¦è®¾è®¡
5. ä¸ç°æœ‰ä»£ç çš„é›†æˆæ˜¯å¦åˆç†
```

### ã€æ¨èã€‘è®¾è®¡æ¨¡å¼ç»„åˆä½¿ç”¨æ£€æŸ¥
```
æç¤ºè¯æ¨¡æ¿ï¼š
@codebase æ£€æŸ¥å¤šä¸ªè®¾è®¡æ¨¡å¼çš„ç»„åˆä½¿ç”¨æ˜¯å¦åˆç†ï¼š
[ç²˜è´´ç»„åˆä½¿ç”¨çš„ä»£ç ]

æ£€æŸ¥å†…å®¹ï¼š
1. æ¨¡å¼é—´çš„åä½œæ˜¯å¦æ¸…æ™°
2. æ˜¯å¦å­˜åœ¨è¿‡åº¦æŠ½è±¡
3. æ•´ä½“å¤æ‚åº¦æ˜¯å¦å¯æ§
4. æ˜¯å¦æœ‰æ›´ç®€å•çš„è§£å†³æ–¹æ¡ˆ
```

---

## å…«ã€è§„èŒƒé›†æˆä¸çº¦æŸ

### ã€é‡è¦ã€‘ä¸å…¶ä»–è§„èŒƒçš„å¼ºåˆ¶çº¦æŸ
1. **ä»£ç è´¨é‡çº¦æŸ**ï¼š
   - æ‰€æœ‰è®¾è®¡æ¨¡å¼å®ç°å¿…é¡»éµå¾ª [java-code-development-and-quality.mdc](mdc:.cursor/rules/java-code-development-and-quality.mdc) çš„æ–¹æ³•è®¾è®¡åŸåˆ™
   - å¼‚å¸¸å¤„ç†å¿…é¡»éµå¾ª [java-error-handling-and-operations.mdc](mdc:.cursor/rules/java-error-handling-and-operations.mdc) è§„èŒƒ
   - äº‹åŠ¡å¤„ç†å¿…é¡»ç¬¦åˆç°æœ‰äº‹åŠ¡ç®¡ç†è§„èŒƒ

2. **æ¶æ„çº¦æŸ**ï¼š
   - è®¾è®¡æ¨¡å¼å¿…é¡»é€‚é… [java-project-architecture-and-structure.mdc](mdc:.cursor/rules/java-project-architecture-and-structure.mdc) çš„åˆ†å±‚æ¶æ„
   - åŒ…ç»“æ„å¿…é¡»ç¬¦åˆé¡¹ç›®ç°æœ‰çš„ç»„ç»‡æ–¹å¼

### ã€æ ¸å¿ƒä»·å€¼ã€‘ç²¾ç»†åŒ–è§„èŒƒçš„ä¼˜åŠ¿
- **ğŸ¯ æ˜ç¡®æŒ‡å¯¼**ï¼šæ¯ä¸ªæ¨¡å¼éƒ½æœ‰å…·ä½“çš„é€‚ç”¨æ¡ä»¶å’Œå®ç°æ­¥éª¤
- **âš¡ é¿å…æ··ä¹±**ï¼šä¸¥æ ¼çš„å‘½åå’Œç»“æ„è§„èŒƒé˜²æ­¢å®ç°æ··ä¹±
- **ğŸ›¡ï¸ è´¨é‡ä¿è¯**ï¼šå¼ºåˆ¶çš„æ ¡éªŒå’Œå¼‚å¸¸å¤„ç†ç¡®ä¿ä»£ç è´¨é‡
- **ğŸ“š å›¢é˜Ÿä¸€è‡´**ï¼šç»Ÿä¸€çš„å®ç°æ¨¡æ¿ä¿è¯å›¢é˜Ÿä»£ç é£æ ¼ä¸€è‡´
- **ğŸ” é—®é¢˜é¢„é˜²**ï¼šè¯¦ç»†çš„çº¦æŸæ¡ä»¶é¿å…è¿‡åº¦è®¾è®¡å’Œè¯¯ç”¨